<!DOCTYPE html><html lang="pt-BR"><head><meta charset="UTF-8"/><title>Anunciamentos</title><meta name="viewport" content="width=device-width,initial-scale=1.0"/><style>body{background:#f0e0d6;font-family:Tahoma,sans-serif;color:#000;margin:0;padding:10px}h1{color:#800000;text-align:center}.post{background:#fefefe;border:1px solid #aaa;margin:10px auto;padding:10px;max-width:700px;box-shadow:2px 2px 5px rgba(0,0,0,.1)}.post img,.post video{max-width:100%;margin-top:10px}.meta{font-size:12px;color:#444;margin-bottom:5px}#formAnuncio{display:none;max-width:700px;margin:20px auto;background:#fff0f0;padding:15px;border:1px solid #d99}.comentario{font-size:13px;border-top:1px solid #ddd;margin-top:5px;padding-top:5px}.comentario strong{color:#800000}.comentar-box{margin-top:10px}</style></head><body><h1>Anunciamentos</h1><div id="formAnuncio"><h3>Nova postagem</h3><textarea id="texto" placeholder="Digite o texto..." style="width:100%;height:80px"></textarea><br><input type="file" id="arquivo" accept="image/*,video/*"><br><br><button id="postarBtn">Postar</button><div id="statusPostagem"></div></div><div id="anuncios"></div><script type="module">import{initializeApp as a}from"https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";import{getFirestore as b,collection as c,query as d,orderBy as e,getDocs as f,addDoc as g,deleteDoc as h,doc as i,setDoc as j,getDoc as k}from"https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";const l={apiKey:"AIzaSyAfJZVeKznju7J-KYTE-oSz6pRfbF6mBdQ",authDomain:"funzer.firebaseapp.com",projectId:"funzer",storageBucket:"funzer.firebasestorage.app",messagingSenderId:"723068647417",appId:"1:723068647417:web:7ae58205191b0099a1ef28"},m="private_K0G6BijrJQ5r+PBaDTPnw1x7hLY=",n="https://upload.imagekit.io/api/v1/files/upload",o=a(l),p=b(o),q=JSON.parse(localStorage.getItem("currentUser"));q?.role==="owner"&&(document.getElementById("formAnuncio").style.display="block");document.getElementById("postarBtn").addEventListener("click",async()=>{let r=document.getElementById("texto").value.trim(),s=document.getElementById("arquivo").files[0],t=document.getElementById("statusPostagem");if(!r&&!s)return void(t.innerText="Escreva algo ou selecione um arquivo.");let u="",v="";if(s){let w=new FormData();w.append("file",s),w.append("fileName",s.name);try{let x=await fetch(n,{method:"POST",headers:{Authorization:`Basic ${btoa(m+":")}`},body:w}),y=await x.json();if(y.url)u=y.url,v=y.fileType;else return void(t.innerText="Erro ao obter URL da imagem.")}catch(z){return void(t.innerText="Erro ao enviar m√≠dia.")}}try{await g(c(p,"post-anunci"),{text:r,image:u||null,fileType:v||null,timestamp:Date.now(),username:q?.username||"An√¥nimo"}),t.innerText="Postagem feita com sucesso!",document.getElementById("texto").value="",document.getElementById("arquivo").value="",C()}catch(z){t.innerText="Erro ao salvar no banco."}});async function C(){let a=document.getElementById("anuncios");a.innerHTML="";let b=d(c(p,"post-anunci"),e("timestamp","desc")),r=await f(b);if(r.empty)a.innerHTML="<p style='text-align:center;color:#444'>Nenhum anunciamento ainda.</p>";for(let s of r.docs){let t=s.data(),u=document.createElement("div");u.className="post";let v="";t.image&&(v=t.fileType==="video"?`<video src="${t.image}" controls></video>`:`<img src="${t.image}" loading="lazy">`);let w="";(q?.role==="owner"||q?.username===t.username)&&(w=`<button onclick="deletarPost('${s.id}')">üóëÔ∏è Apagar</button>`);let x=i(p,"likes",s.id),y=await k(x),z=y.exists()?y.data():{},A=Object.keys(z).length,B=q?.username&&z[q.username]?"‚ù§Ô∏è":"ü§ç",D=B;let E=B==="‚ù§Ô∏è"?`style="color:red"`:"";let F=await f(c(p,"comentarios",s.id,"itens")),G="";F.forEach(h=>{let i=h.data();G+=`<div class="comentario"><strong>${i.username}:</strong> ${i.text}</div>`}),u.innerHTML=`<div class="meta">${t.username||"An√¥nimo"} - ${new Date(t.timestamp).toLocaleString("pt-BR")} ${w}</div><div>${t.text||""}</div>${v}<div style="margin-top:10px"><button id="like-btn-${s.id}" onclick="toggleCora('${s.id}')" ${E}>${D} ${A}</button></div><div class="comentar-box"><input type="text" id="comentario-${s.id}" placeholder="Escreva um coment√°rio..." style="width:80%"><button onclick="comentar('${s.id}')">Comentar</button></div><div>${G}</div>`,a.appendChild(u)}}window.deletarPost=async a=>{if(!confirm("Tem certeza que deseja apagar este post?"))return;await h(i(p,"post-anunci",a)),alert("Post apagado."),C()},window.toggleCora=async a=>{if(!q?.username)return alert("Voc√™ precisa estar logado.");let b=i(p,"likes",a),c=await k(b),d=c.exists()?c.data():{};d[q.username]?delete d[q.username]:d[q.username]=!0,await j(b,d);let e=Object.keys(d).length,f=document.querySelector(`#like-btn-${a}`);f&&(f.innerText=`‚ù§Ô∏è ${e}`,f.style.color=d[q.username]?"red":"")},window.comentar=async a=>{let b=document.getElementById(`comentario-${a}`),c=b.value.trim();if(!c)return;await g(c(p,"comentarios",a,"itens"),{username:q?.username||"An√¥nimo",text:c,timestamp:Date.now()}),b.value="",C()},C();</script></body></html>
